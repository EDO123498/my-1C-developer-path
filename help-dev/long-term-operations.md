`the manager module:`
```js
&НаСервере
Процедура тснИнтеграцияРобертс(Параметры, АдресРезультата) Экспорт
				
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Номенклатура.Ссылка КАК Ссылка,
		|	Номенклатура.Наименование КАК Наименование
		|ИЗ
		|	Справочник.Номенклатура КАК Номенклатура";
	
	РезультатЗапроса = Запрос.Выполнить();
		
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	тснКоличество = ВыборкаДетальныеЗаписи.Количество();
	тснТекущийИндекс = 1;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		тснСайтИнтеграцияНоменклатура.ПолучитьНоменклатуруСервер(ВыборкаДетальныеЗаписи.Ссылка);
		ПроцентВыполнения = (тснТекущийИндекс/тснКоличество)*100;
		ПроцентВыполнения = Окр(ПроцентВыполнения, 0);	
		тснТекущийИндекс = тснТекущийИндекс + 1;
		ДлительныеОперации.СообщитьПрогресс(ПроцентВыполнения, ВыборкаДетальныеЗаписи.Наименование);
	КонецЦикла;
		
КонецПроцедуры
```
`the form module:`
```js
&НаКлиенте
Процедура ВыполнитьВыгрузку(Команда)
	ВыполнитьВыгрузкуНаСервере();
	ТекущийПрогресс = 0;
	ПодключитьОбработчикОжидания("ОбновитьПрогресс", 1, Ложь);
КонецПроцедуры
```
```js
&НаСервере
Процедура ВыполнитьВыгрузкуНаСервере()
	тснПараметрыПроцедуры = Новый Структура("Регистратор", "Тест");
	тснПараметрыВыполнения = ДлительныеОперации.ПараметрыВыполненияВФоне(Новый УникальныйИдентификатор);
	тснПараметрыВыполнения.ЗапуститьВФоне = Истина;
	
	тснЗадание = ДлительныеОперации.ВыполнитьВФоне("Обработки.тснПервичнаяСинхронизация.тснИнтеграцияРобертс",
							тснПараметрыПроцедуры,
							тснПараметрыВыполнения);
    	АдресРезультата = тснЗадание.АдресРезультата;
	ИдентификаторЗадания = тснЗадание.ИдентификаторЗадания;	
КонецПроцедуры
```

```js
&НаКлиенте
Процедура ОбновитьПрогресс() Экспорт
	ОбновитьПрогрессНаСервере();
КонецПроцедуры
```
```js
&НаСервере
Процедура ОбновитьПрогрессНаСервере() 
	
	Прогресс = ДлительныеОперации.ПрочитатьПрогресс(ИдентификаторЗадания);
	Если Прогресс <> Неопределено Тогда
		ТекущийПрогресс = Прогресс.Процент;
		Элементы.тснТекущийПрогресс.Заголовок = Прогресс.Текст;
	КонецЕсли;
	
	СостояниеЗадания = ДлительныеОперации.ОперацияВыполнена(ИдентификаторЗадания, Истина);
	
	ЗаданиеВыполняется = СостояниеЗадания.Статус = "Выполняется";
	Если СостояниеЗадания.Статус = "Выполнено" Тогда
		Результат = ПолучитьИзВременногоХранилища(АдресРезультата);
	
		РезультатЗагрузки = "Номенклатуры добавлено: " + Результат.ПозицийДобавлено + Символы.ПС;
		РезультатЗагрузки = РезультатЗагрузки
                            + "Номенклатуры обновлено: "
                            + Результат.ПозицийОбновлено
                            + Символы.ПС;
		ЕстьОшибки = Результат.Ошибки.Количество() > 0;
		Если ЕстьОшибки Тогда
			РезультатЗагрузки = РезультатЗагрузки
                                  + "Конфликты при загрузке: "
                                  + Символы.ПС
                                  + Символы.ПС;
			Для Каждого Ошибка Из Результат.Ошибки Цикл
				РезультатЗагрузки = РезультатЗагрузки + Ошибка + Символы.ПС;
			КонецЦикла;
		КонецЕсли;                                    
		Элементы.тснТекущийПрогресс.Заголовок	 = "";
	ИначеЕсли СостояниеЗадания.Статус = "Ошибка" Тогда
		
		ЕстьОшибки = Истина;   
		РезультатЗагрузки = "Ошибка загрузки " + Символы.ПС;
		РезультатЗагрузки = РезультатЗагрузки + СостояниеЗадания.КраткоеПредставлениеОшибки;
		
	КонецЕсли;
    	ОбновитьВидимостьЭлементов();
		
КонецПроцедуры
```
```js
&НаКлиенте
Процедура Отмена(Команда)
	Если ЗаданиеВыполняется Тогда 
		тснОповещение = Новый ОписаниеОповещения("ОтменаЗавершение", ЭтотОбъект);	
		ПоказатьВопрос(тснОповещение,
				"Прекратить выполнение операции синхронизации товаров с сайтом?",
				РежимДиалогаВопрос.ДаНет,
				60,
				КодВозвратаДиалога.Нет,
				"Предупреждение",
				КодВозвратаДиалога.Нет);
	КонецЕсли;
КонецПроцедуры
```
```js
&НаКлиенте
Процедура ОтменаЗавершение(РезультатДиалогаВопрос, ДополнительныеПараметры) Экспорт;
	Если РезультатДиалогаВопрос = КодВозвратаДиалога.Да Тогда
		ОтменитьВыполнениеЗадания();
	КонецЕсли;
КонецПроцедуры
```
```js
&НаСервере
Процедура ОтменитьВыполнениеЗадания()
	ДлительныеОперации.ОтменитьВыполнениеЗадания(ИдентификаторЗадания);
КонецПроцедуры
```
```js
&НаСервере
Процедура Пауза(пИнтервал)
	тснЗадержка = ТекущаяДата() + пИнтервал;
	Пока ТекущаяДата() < тснЗадержка Цикл
	КонецЦикла;    
КонецПроцедуры
```
