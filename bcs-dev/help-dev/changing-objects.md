```js
пСообщение = XMLСтрока(ТекущаяДата()) + ": Начинаю расчет количества записей...";
Сообщить(пСообщение);

пТЗ = мРезультатЗапроса.Выгрузить();
пКоличество = пТЗ.Количество();

пСообщение = СтрШаблон("%1: Количество записей для изменения составляет: %2",
						XMLСтрока(ТекущаяДата()),
						пКоличество);
Сообщить(пСообщение);
пСчетчик = 0;
НачатьТранзакцию();
Попытка
	Для Каждого пСтрока Из пТЗ Цикл 
		//меняем в выводе
		пДокументСсылкаВывод = пСтрока.ВыводСсылка;
		пДокументОбъектВывод = пДокументСсылкаВывод.ПолучитьОбъект();
		пПрошлоеЗначение1 = пДокументСсылкаВывод.ПоДокументу;
		пДокументОбъектВывод.ПоДокументу = пСтрока.БлокировкаСсылка;
		пДокументОбъектВывод.Записать(РежимЗаписиДокумента.Запись);
		пСообщениеЛога = "BROKERSUP-41942: Изменен реквизит ПоДокументу для "
						+ пДокументСсылкаВывод + " с "
						+ пПрошлоеЗначение1
						+" на "
						+ пДокументСсылкаВывод.ПоДокументу; 
		СообщитьЛог(пСообщениеЛога, , пДокументСсылкаВывод, "Скрипты", Ложь);
		//меняем в вводе
		пДокументСсылкаВвод = пСтрока.ВводСсылка;
		пДокументОбъектВвод = пДокументСсылкаВвод.ПолучитьОбъект();
		пПрошлоеЗначение2 = пДокументСсылкаВвод.ПоДокументу;
		пДокументОбъектВвод.ПоДокументу = пСтрока.ВыводСсылка;
		пДокументОбъектВвод.Записать(РежимЗаписиДокумента.Запись);
		пСообщениеЛога = "BROKERSUP-41942: Изменен реквизит ПоДокументу для "
						+ пДокументСсылкаВвод
						+ " с "
						+ пПрошлоеЗначение2
						+ " на " 
						+ пДокументСсылкаВвод.ПоДокументу; 
		СообщитьЛог(пСообщениеЛога, , пДокументСсылкаВвод, "Скрипты", Ложь);
		
		пСчетчик = пСчетчик + 1;
		Если пСчетчик % 100 = 0 Тогда 
			пСообщение = СтрШаблон("%1: Обработано записей: %2 из %3",
									XMLСтрока(ТекущаяДата()),
									пСчетчик, 
									пКоличество);
			Сообщить(пСообщение);
		КонецЕсли;
		
	КонецЦикла;
Исключение
	пСообщение = "При записи документа произошла ошибка: " + ОписаниеОшибки(); 
	Сообщить(пСообщение);
	ОтменитьТранзакцию();
КонецПопытки;
Если ТранзакцияАктивна() Тогда
	ЗафиксироватьТранзакцию();
	пСообщение = XMLСтрока(ТекущаяДата()) + ": Изменение данных завершено успешно...";
	Сообщить(пСообщение);
Иначе
	пСообщение = XMLСтрока(ТекущаяДата()) + ": Изменение данных завершено с ошибкой...";
	Сообщить(пСообщение);
КонецЕсли;
ПечатьТЗ(пТЗ);
```
